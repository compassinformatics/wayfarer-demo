import{l as kt,E as Wt,m,n as Bt,o as Ht,q as Qt,r as ut,L as qt,s as $t,u as N,v as ft,w as Vt,x as Jt,y as te,z as dt,c as Rt,A as At,H as at,I as ht,J as Tt,K as ee,N as gt,O as ie,h as se,P as ne,Q as oe,U as yt,W as St,X as nt,Y as re,Z as Ct,_ as ae,$ as wt,a0 as he,a1 as Lt,a2 as le,a3 as Ot,a4 as Pt,a5 as $,a6 as Xt,a7 as ce,a8 as ue,a9 as de,aa as ge}from"./networklayer-42fddc28.js";class fe extends kt{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(Wt.CHANGE)}release(){this.state===m.ERROR&&this.setState(m.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==m.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(t.getState()==m.LOADED){t.interimTile=null;break}else t.getState()==m.LOADING?e=t:t.getState()==m.IDLE?e.interimTile=t.interimTile:e=t;t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==m.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){Bt()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;const n=e-i+1e3/60;return n>=this.transition_?1:Ht(n/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}const bt=fe;class Te extends bt{constructor(t,e,i,n,s,c){super(t,e,c),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=m.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=m.ERROR,this.unlistenImage_(),this.image_=me(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=m.LOADED:this.state=m.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==m.ERROR&&(this.state=m.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==m.IDLE&&(this.state=m.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Qt(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function me(){const g=ut(1,1);return g.fillStyle="rgba(0,0,0,0)",g.fillRect(0,0,1,1),g.canvas}const _e=Te;class jt{constructor(t,e,i,n){this.minX=t,this.maxX=e,this.minY=i,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Ye(g,t,e,i,n){return n!==void 0?(n.minX=g,n.maxX=t,n.minY=e,n.maxY=i,n):new jt(g,t,e,i)}const xe=jt,st={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Ee extends qt{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(st.PRELOAD)}setPreload(t){this.set(st.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(st.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(st.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}const pe=Ee,Ie=.5,ve=10,Dt=.25;class Re{constructor(t,e,i,n,s,c){this.sourceProj_=t,this.targetProj_=e;let h={};const f=$t(this.targetProj_,this.sourceProj_);this.transformInv_=function(u){const o=u[0]+"/"+u[1];return h[o]||(h[o]=f(u)),h[o]},this.maxSourceExtent_=n,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&N(n)==N(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?N(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?N(this.targetProj_.getExtent()):null;const l=ft(i),p=Vt(i),x=Jt(i),r=te(i),T=this.transformInv_(l),d=this.transformInv_(p),_=this.transformInv_(x),I=this.transformInv_(r),E=ve+(c?Math.max(0,Math.ceil(Math.log2(dt(i)/(c*c*256*256)))):0);if(this.addQuad_(l,p,x,r,T,d,_,I,E),this.wrapsXInSource_){let u=1/0;this.triangles_.forEach(function(o,a,R){u=Math.min(u,o.source[0][0],o.source[1][0],o.source[2][0])}),this.triangles_.forEach(function(o){if(Math.max(o.source[0][0],o.source[1][0],o.source[2][0])-u>this.sourceWorldWidth_/2){const a=[[o.source[0][0],o.source[0][1]],[o.source[1][0],o.source[1][1]],[o.source[2][0],o.source[2][1]]];a[0][0]-u>this.sourceWorldWidth_/2&&(a[0][0]-=this.sourceWorldWidth_),a[1][0]-u>this.sourceWorldWidth_/2&&(a[1][0]-=this.sourceWorldWidth_),a[2][0]-u>this.sourceWorldWidth_/2&&(a[2][0]-=this.sourceWorldWidth_);const R=Math.min(a[0][0],a[1][0],a[2][0]);Math.max(a[0][0],a[1][0],a[2][0])-R<this.sourceWorldWidth_/2&&(o.source=a)}}.bind(this))}h={}}addTriangle_(t,e,i,n,s,c){this.triangles_.push({source:[n,s,c],target:[t,e,i]})}addQuad_(t,e,i,n,s,c,h,f,l){const p=Rt([s,c,h,f]),x=this.sourceWorldWidth_?N(p)/this.sourceWorldWidth_:null,r=this.sourceWorldWidth_,T=this.sourceProj_.canWrapX()&&x>.5&&x<1;let d=!1;if(l>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const I=Rt([t,e,i,n]);d=N(I)/this.targetWorldWidth_>Dt||d}!T&&this.sourceProj_.isGlobal()&&x&&(d=x>Dt||d)}if(!d&&this.maxSourceExtent_&&isFinite(p[0])&&isFinite(p[1])&&isFinite(p[2])&&isFinite(p[3])&&!At(p,this.maxSourceExtent_))return;let _=0;if(!d&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(c[0])||!isFinite(c[1])||!isFinite(h[0])||!isFinite(h[1])||!isFinite(f[0])||!isFinite(f[1]))){if(l>0)d=!0;else if(_=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(c[0])||!isFinite(c[1])?4:0)+(!isFinite(h[0])||!isFinite(h[1])?2:0)+(!isFinite(f[0])||!isFinite(f[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(l>0){if(!d){const I=[(t[0]+i[0])/2,(t[1]+i[1])/2],E=this.transformInv_(I);let u;T?u=(at(s[0],r)+at(h[0],r))/2-at(E[0],r):u=(s[0]+h[0])/2-E[0];const o=(s[1]+h[1])/2-E[1];d=u*u+o*o>this.errorThresholdSquared_}if(d){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const I=[(e[0]+i[0])/2,(e[1]+i[1])/2],E=this.transformInv_(I),u=[(n[0]+t[0])/2,(n[1]+t[1])/2],o=this.transformInv_(u);this.addQuad_(t,e,I,u,s,c,E,o,l-1),this.addQuad_(u,I,i,n,o,E,h,f,l-1)}else{const I=[(t[0]+e[0])/2,(t[1]+e[1])/2],E=this.transformInv_(I),u=[(i[0]+n[0])/2,(i[1]+n[1])/2],o=this.transformInv_(u);this.addQuad_(t,I,u,n,s,E,o,f,l-1),this.addQuad_(I,e,i,u,E,c,h,o,l-1)}return}}if(T){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(t,i,n,s,h,f),_&14||this.addTriangle_(t,i,e,s,h,c),_&&(_&13||this.addTriangle_(e,n,t,c,f,s),_&7||this.addTriangle_(e,n,i,c,f,h))}calculateSourceExtent(){const t=Tt();return this.triangles_.forEach(function(e,i,n){const s=e.source;ht(t,s[0]),ht(t,s[1]),ht(t,s[2])}),t}getTriangles(){return this.triangles_}}const ye=Re;let lt;const Ut=[];function Mt(g,t,e,i,n){g.beginPath(),g.moveTo(0,0),g.lineTo(t,e),g.lineTo(i,n),g.closePath(),g.save(),g.clip(),g.fillRect(0,0,Math.max(t,i)+1,Math.max(e,n)),g.restore()}function ct(g,t){return Math.abs(g[t*4]-210)>2||Math.abs(g[t*4+3]-.75*255)>2}function Ce(){if(lt===void 0){const g=document.createElement("canvas").getContext("2d");g.globalCompositeOperation="lighter",g.fillStyle="rgba(210, 0, 0, 0.75)",Mt(g,4,5,4,0),Mt(g,4,5,0,5);const t=g.getImageData(0,0,3,3).data;lt=ct(t,0)||ct(t,4)||ct(t,8)}return lt}function Yt(g,t,e,i){const n=oe(e,t,g);let s=yt(t,i,e);const c=t.getMetersPerUnit();c!==void 0&&(s*=c);const h=g.getMetersPerUnit();h!==void 0&&(s/=h);const f=g.getExtent();if(!f||St(f,n)){const l=yt(g,s,n)/s;isFinite(l)&&l>0&&(s/=l)}return s}function we(g,t,e,i){const n=se(e);let s=Yt(g,t,n,i);return(!isFinite(s)||s<=0)&&ne(e,function(c){return s=Yt(g,t,c,i),isFinite(s)&&s>0}),s}function Le(g,t,e,i,n,s,c,h,f,l,p,x){const r=ut(Math.round(e*g),Math.round(e*t),Ut);if(x||(r.imageSmoothingEnabled=!1),f.length===0)return r.canvas;r.scale(e,e);function T(a){return Math.round(a*e)/e}r.globalCompositeOperation="lighter";const d=Tt();f.forEach(function(a,R,y){ee(d,a.extent)});const _=N(d),I=gt(d),E=ut(Math.round(e*_/i),Math.round(e*I/i));x||(E.imageSmoothingEnabled=!1);const u=e/i;f.forEach(function(a,R,y){const C=a.extent[0]-d[0],w=-(a.extent[3]-d[3]),P=N(a.extent),Y=gt(a.extent);a.image.width>0&&a.image.height>0&&E.drawImage(a.image,l,l,a.image.width-2*l,a.image.height-2*l,C*u,w*u,P*u,Y*u)});const o=ft(c);return h.getTriangles().forEach(function(a,R,y){const C=a.source,w=a.target;let P=C[0][0],Y=C[0][1],Z=C[1][0],G=C[1][1],K=C[2][0],V=C[2][1];const W=T((w[0][0]-o[0])/s),b=T(-(w[0][1]-o[1])/s),v=T((w[1][0]-o[0])/s),M=T(-(w[1][1]-o[1])/s),j=T((w[2][0]-o[0])/s),A=T(-(w[2][1]-o[1])/s),B=P,X=Y;P=0,Y=0,Z-=B,G-=X,K-=B,V-=X;const S=[[Z,G,0,0,v-W],[K,V,0,0,j-W],[0,0,Z,G,M-b],[0,0,K,V,A-b]],O=ie(S);if(O){if(r.save(),r.beginPath(),Ce()||!x){r.moveTo(v,M);const L=4,H=W-v,k=b-M;for(let D=0;D<L;D++)r.lineTo(v+T((D+1)*H/L),M+T(D*k/(L-1))),D!=L-1&&r.lineTo(v+T((D+1)*H/L),M+T((D+1)*k/(L-1)));r.lineTo(j,A)}else r.moveTo(v,M),r.lineTo(W,b),r.lineTo(j,A);r.clip(),r.transform(O[0],O[2],O[1],O[3],W,b),r.translate(d[0]-B,d[3]-X),r.scale(i/e,-i/e),r.drawImage(E.canvas,0,0),r.restore()}}),p&&(r.save(),r.globalCompositeOperation="source-over",r.strokeStyle="black",r.lineWidth=1,h.getTriangles().forEach(function(a,R,y){const C=a.target,w=(C[0][0]-o[0])/s,P=-(C[0][1]-o[1])/s,Y=(C[1][0]-o[0])/s,Z=-(C[1][1]-o[1])/s,G=(C[2][0]-o[0])/s,K=-(C[2][1]-o[1])/s;r.beginPath(),r.moveTo(Y,Z),r.lineTo(w,P),r.lineTo(G,K),r.closePath(),r.stroke()}),r.restore()),r.canvas}class Oe extends bt{constructor(t,e,i,n,s,c,h,f,l,p,x,r){super(s,m.IDLE,{interpolate:!!r}),this.renderEdges_=x!==void 0?x:!1,this.pixelRatio_=h,this.gutter_=f,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=c||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const T=n.getTileCoordExtent(this.wrappedTileCoord_),d=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const I=d?nt(T,d):T;if(dt(I)===0){this.state=m.EMPTY;return}const E=t.getExtent();E&&(_?_=nt(_,E):_=E);const u=n.getResolution(this.wrappedTileCoord_[0]),o=we(t,i,I,u);if(!isFinite(o)||o<=0){this.state=m.EMPTY;return}const a=p!==void 0?p:Ie;if(this.triangulation_=new ye(t,i,I,_,o*a,u),this.triangulation_.getTriangles().length===0){this.state=m.EMPTY;return}this.sourceZ_=e.getZForResolution(o);let R=this.triangulation_.calculateSourceExtent();if(_&&(t.canWrapX()?(R[1]=wt(R[1],_[1],_[3]),R[3]=wt(R[3],_[1],_[3])):R=nt(R,_)),!dt(R))this.state=m.EMPTY;else{const y=e.getTileRangeForExtentAndZ(R,this.sourceZ_);for(let C=y.minX;C<=y.maxX;C++)for(let w=y.minY;w<=y.maxY;w++){const P=l(this.sourceZ_,C,w,h);P&&this.sourceTiles_.push(P)}this.sourceTiles_.length===0&&(this.state=m.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(function(e,i,n){e&&e.getState()==m.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,t.length===0)this.state=m.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],c=this.targetTileGrid_.getResolution(e),h=this.sourceTileGrid_.getResolution(this.sourceZ_),f=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Le(n,s,this.pixelRatio_,h,this.sourceTileGrid_.getExtent(),c,f,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=m.LOADED}this.changed()}load(){if(this.state==m.IDLE){this.state=m.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,i,n){const s=e.getState();if(s==m.IDLE||s==m.LOADING){t++;const c=re(e,Wt.CHANGE,function(h){const f=e.getState();(f==m.LOADED||f==m.ERROR||f==m.EMPTY)&&(Ct(c),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(c)}}.bind(this)),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,i,n){e.getState()==m.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Ct),this.sourcesListenerKeys_=null}release(){this.canvas_&&(ae(this.canvas_.getContext("2d")),Ut.push(this.canvas_),this.canvas_=null),super.release()}}const Ft=Oe;class Pe extends he{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Tt(),this.tmpTileRange_=new xe(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),n=e.getUseInterimTilesOnError();return i==m.LOADED||i==m.EMPTY||i==m.ERROR&&!n}getTile(t,e,i,n){const s=n.pixelRatio,c=n.viewState.projection,h=this.getLayer();let l=h.getSource().getTile(t,e,i,s,c);return l.getState()==m.ERROR&&h.getUseInterimTilesOnError()&&h.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(l)||(l=l.getInterimTile()),l}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),n=Lt(e.pixelToCoordinateTransform,t.slice()),s=i.getExtent();if(s&&!St(s,n))return null;const c=e.pixelRatio,h=e.viewState.projection,f=e.viewState,l=i.getRenderSource(),p=l.getTileGridForProjection(f.projection),x=l.getTilePixelRatio(e.pixelRatio);for(let r=p.getZForResolution(f.resolution);r>=p.getMinZoom();--r){const T=p.getTileCoordForCoordAndZ(n,r),d=l.getTile(r,T[1],T[2],c,h);if(!(d instanceof _e||d instanceof Ft)||d instanceof Ft&&d.getState()===m.EMPTY)return null;if(d.getState()!==m.LOADED)continue;const _=p.getOrigin(r),I=le(p.getTileSize(r)),E=p.getResolution(r),u=Math.floor(x*((n[0]-_[0])/E-T[1]*I[0])),o=Math.floor(x*((_[1]-n[1])/E-T[2]*I[1])),a=Math.round(x*l.getGutterForProjection(f.projection));return this.getImageData(d.getImage(),u+a,o+a)}return null}loadedTileCallback(t,e,i){return this.isDrawableTile(i)?super.loadedTileCallback(t,e,i):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],n=t.viewState,s=n.projection,c=n.resolution,h=n.center,f=n.rotation,l=t.pixelRatio,p=this.getLayer(),x=p.getSource(),r=x.getRevision(),T=x.getTileGridForProjection(s),d=T.getZForResolution(c,x.zDirection),_=T.getResolution(d);let I=t.extent;const E=t.viewState.resolution,u=x.getTilePixelRatio(l),o=Math.round(N(I)/E*l),a=Math.round(gt(I)/E*l),R=i.extent&&Ot(i.extent);R&&(I=nt(I,Ot(i.extent)));const y=_*o/2/u,C=_*a/2/u,w=[h[0]-y,h[1]-C,h[0]+y,h[1]+C],P=T.getTileRangeForExtentAndZ(I,d),Y={};Y[d]={};const Z=this.createLoadedTileFinder(x,s,Y),G=this.tmpExtent,K=this.tmpTileRange_;this.newTiles_=!1;const V=f?Pt(n.center,E,f,t.size):void 0;for(let S=P.minX;S<=P.maxX;++S)for(let O=P.minY;O<=P.maxY;++O){if(f&&!T.tileCoordIntersectsViewport([d,S,O],V))continue;const L=this.getTile(d,S,O,t);if(this.isDrawableTile(L)){const D=$(this);if(L.getState()==m.LOADED){Y[d][L.tileCoord.toString()]=L;let Q=L.inTransition(D);Q&&i.opacity!==1&&(L.endTransition(D),Q=!1),!this.newTiles_&&(Q||!this.renderedTiles.includes(L))&&(this.newTiles_=!0)}if(L.getAlpha(D,t.time)===1)continue}const H=T.getTileCoordChildTileRange(L.tileCoord,K,G);let k=!1;H&&(k=Z(d+1,H)),k||T.forEachTileCoordParentTileRange(L.tileCoord,Z,K,G)}const W=_/c*l/u;Xt(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/l,1/l,f,-o/2,-a/2);const b=ce(this.pixelTransform);this.useContainer(e,b,this.getBackground(t));const v=this.context,M=v.canvas;ue(this.inversePixelTransform,this.pixelTransform),Xt(this.tempTransform,o/2,a/2,W,W,0,-o/2,-a/2),M.width!=o||M.height!=a?(M.width=o,M.height=a):this.containerReused||v.clearRect(0,0,o,a),R&&this.clipUnrotated(v,t,R),x.getInterpolate()||(v.imageSmoothingEnabled=!1),this.preRender(v,t),this.renderedTiles.length=0;let j=Object.keys(Y).map(Number);j.sort(de);let A,B,X;i.opacity===1&&(!this.containerReused||x.getOpaque(t.viewState.projection))?j=j.reverse():(A=[],B=[]);for(let S=j.length-1;S>=0;--S){const O=j[S],L=x.getTilePixelSize(O,l,s),k=T.getResolution(O)/_,D=L[0]*k*W,Q=L[1]*k*W,ot=T.getTileCoordForCoordAndZ(ft(w),O),mt=T.getTileCoordExtent(ot),et=Lt(this.tempTransform,[u*(mt[0]-w[0])/_,u*(w[3]-mt[3])/_]),zt=u*x.getGutterForProjection(s),_t=Y[O];for(const Nt in _t){const q=_t[Nt],xt=q.tileCoord,Et=ot[1]-xt[1],Zt=Math.round(et[0]-(Et-1)*D),pt=ot[2]-xt[2],Gt=Math.round(et[1]-(pt-1)*Q),U=Math.round(et[0]-Et*D),z=Math.round(et[1]-pt*Q),J=Zt-U,tt=Gt-z,It=d===O,vt=It&&q.getAlpha($(this),t.time)!==1;let rt=!1;if(!vt)if(A){X=[U,z,U+J,z,U+J,z+tt,U,z+tt];for(let it=0,Kt=A.length;it<Kt;++it)if(d!==O&&O<B[it]){const F=A[it];At([U,z,U+J,z+tt],[F[0],F[3],F[4],F[7]])&&(rt||(v.save(),rt=!0),v.beginPath(),v.moveTo(X[0],X[1]),v.lineTo(X[2],X[3]),v.lineTo(X[4],X[5]),v.lineTo(X[6],X[7]),v.moveTo(F[6],F[7]),v.lineTo(F[4],F[5]),v.lineTo(F[2],F[3]),v.lineTo(F[0],F[1]),v.clip())}A.push(X),B.push(O)}else v.clearRect(U,z,J,tt);this.drawTileImage(q,t,U,z,J,tt,zt,It),A&&!vt?(rt&&v.restore(),this.renderedTiles.unshift(q)):this.renderedTiles.push(q),this.updateUsedTiles(t.usedTiles,x,q)}}return this.renderedRevision=r,this.renderedResolution=_,this.extentChanged=!this.renderedExtent_||!ge(this.renderedExtent_,w),this.renderedExtent_=w,this.renderedPixelRatio=l,this.renderedProjection=s,this.manageTilePyramid(t,x,T,l,s,I,d,p.getPreload()),this.scheduleExpireCache(t,x),this.postRender(v,t),i.extent&&v.restore(),v.imageSmoothingEnabled=!0,b!==M.style.transform&&(M.style.transform=b),this.container}drawTileImage(t,e,i,n,s,c,h,f){const l=this.getTileImage(t);if(!l)return;const p=$(this),x=e.layerStatesArray[e.layerIndex],r=x.opacity*(f?t.getAlpha(p,e.time):1),T=r!==this.context.globalAlpha;T&&(this.context.save(),this.context.globalAlpha=r),this.context.drawImage(l,h,h,l.width-2*h,l.height-2*h,i,n,s,c),T&&this.context.restore(),r!==x.opacity?e.animate=!0:f&&t.endTransition(p)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=function(n,s,c){const h=$(n);h in c.usedTiles&&n.expireCache(c.viewState.projection,c.usedTiles[h])}.bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const n=$(e);n in t||(t[n]={}),t[n][i.getKey()]=!0}manageTilePyramid(t,e,i,n,s,c,h,f,l){const p=$(e);p in t.wantedTiles||(t.wantedTiles[p]={});const x=t.wantedTiles[p],r=t.tileQueue,T=i.getMinZoom(),d=t.viewState.rotation,_=d?Pt(t.viewState.center,t.viewState.resolution,d,t.size):void 0;let I=0,E,u,o,a,R,y;for(y=T;y<=h;++y)for(u=i.getTileRangeForExtentAndZ(c,y,u),o=i.getResolution(y),a=u.minX;a<=u.maxX;++a)for(R=u.minY;R<=u.maxY;++R)d&&!i.tileCoordIntersectsViewport([y,a,R],_)||(h-y<=f?(++I,E=e.getTile(y,a,R,n,s),E.getState()==m.IDLE&&(x[E.getKey()]=!0,r.isKeyQueued(E.getKey())||r.enqueue([E,p,i.getTileCoordCenter(E.tileCoord),o])),l!==void 0&&l(E)):e.useTile(y,a,R,s));e.updateCacheSize(I,s)}}const Xe=Pe;class De extends pe{constructor(t){super(t)}createRenderer(){return new Xe(this)}}const Fe=De;export{_e as I,Ft as R,Fe as T,xe as a,Ye as c};
//# sourceMappingURL=Tile-331d8e26.js.map
