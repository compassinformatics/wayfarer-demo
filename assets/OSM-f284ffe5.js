import{A as xe,B as wt,H as T,J as Jt,K as Ee,L as pe,N as st,O as Re,P as tt,Q as ye,U as we,W as G,X as Ct,Y as Ce,Z as Fe,_ as Se,$ as ht,c as Nt,a0 as te,a1 as Et,a2 as St,a3 as At,a4 as Ie,a5 as lt,a6 as Le,a7 as ut,h as Pe,a8 as ve,a9 as De,aa as Bt,ab as Gt,ac as N,ad as ee,ae as pt,af as dt,ag as ie,ah as Me,ai as $t,aj as et,q as k,ak as zt,al as ze,am as Xe,an as Oe,ao as Ae,ap as ne,aq as se,ar as Ge,as as je,at as Tt,au as mt,av as jt,aw as Ye,ax as be,ay as Ze,az as Ue,aA as Ke,E as We,aB as It}from"./networklayer-bc81f725.js";class ke extends xe{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(wt.CHANGE)}release(){this.state===T.ERROR&&this.setState(T.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==T.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){Jt()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;const n=e-i+1e3/60;return n>=this.transition_?1:Ee(n/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}const Yt=ke;class Ne extends Yt{constructor(t,e,i,n,s,o){super(t,e,o),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=T.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=T.ERROR,this.unlistenImage_(),this.image_=Be(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=T.LOADED:this.state=T.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==T.ERROR&&(this.state=T.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==T.IDLE&&(this.state=T.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=pe(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function Be(){const r=st(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}const re=Ne;class $e{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();){const e=this.pop();e instanceof Re&&e.dispose()}}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return tt(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return tt(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){tt(!(t in this.entries_),"Tried to set a value for a key that is used already");const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}const qe=$e;function Rt(r,t,e,i){return i!==void 0?(i[0]=r,i[1]=t,i[2]=e,i):[r,t,e]}function He(r,t,e){return r+"/"+t+"/"+e}function Qe(r){return Ve(r[0],r[1],r[2])}function Ve(r,t,e){return(t<<r)+e}function Je(r,t){const e=r[0],i=r[1],n=r[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return s?s.containsXY(i,n):!0}class oe{constructor(t,e,i,n){this.minX=t,this.maxX=e,this.minY=i,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function rt(r,t,e,i,n){return n!==void 0?(n.minX=r,n.maxX=t,n.minY=e,n.maxY=i,n):new oe(r,t,e,i)}const ae=oe,xt={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class ti extends ye{constructor(t){t=t||{};const e=Object.assign({},t),i=t.cacheSize;delete t.cacheSize,delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(xt.PRELOAD)}setPreload(t){this.set(xt.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(xt.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(xt.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}const ei=ti;function yt(r){return r instanceof Image||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageBitmap?r:null}function ii(r){return r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Float32Array||r instanceof DataView?r:null}const ni=new Error("disposed");let ot=null;function si(r){ot||(ot=st(r.width,r.height,void 0,{willReadFrequently:!0}));const t=ot.canvas,e=r.width;t.width!==e&&(t.width=e);const i=r.height;return t.height!==i&&(t.height=i),ot.clearRect(0,0,e,i),ot.drawImage(r,0,0),ot.getImageData(0,0,e,i).data}const ri=[256,256];class oi extends Yt{constructor(t){const e=T.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;const t=yt(this.data_);return t?[t.width,t.height]:ri}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==T.IDLE&&this.state!==T.ERROR)return;this.state=T.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=T.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=T.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(ni),this.controller_=null),super.disposeInternal()}}const Xt=oi,le=.5,ai=10,qt=.25;class li{constructor(t,e,i,n,s,o){this.sourceProj_=t,this.targetProj_=e;let a={};const c=we(this.targetProj_,this.sourceProj_);this.transformInv_=function(g){const m=g[0]+"/"+g[1];return a[m]||(a[m]=c(g)),a[m]},this.maxSourceExtent_=n,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&G(n)>=G(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?G(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?G(this.targetProj_.getExtent()):null;const h=Ct(i),u=Ce(i),_=Fe(i),R=Se(i),w=this.transformInv_(h),l=this.transformInv_(u),d=this.transformInv_(_),p=this.transformInv_(R),x=ai+(o?Math.max(0,Math.ceil(Math.log2(ht(i)/(o*o*256*256)))):0);if(this.addQuad_(h,u,_,R,w,l,d,p,x),this.wrapsXInSource_){let g=1/0;this.triangles_.forEach(function(m,E,f){g=Math.min(g,m.source[0][0],m.source[1][0],m.source[2][0])}),this.triangles_.forEach(m=>{if(Math.max(m.source[0][0],m.source[1][0],m.source[2][0])-g>this.sourceWorldWidth_/2){const E=[[m.source[0][0],m.source[0][1]],[m.source[1][0],m.source[1][1]],[m.source[2][0],m.source[2][1]]];E[0][0]-g>this.sourceWorldWidth_/2&&(E[0][0]-=this.sourceWorldWidth_),E[1][0]-g>this.sourceWorldWidth_/2&&(E[1][0]-=this.sourceWorldWidth_),E[2][0]-g>this.sourceWorldWidth_/2&&(E[2][0]-=this.sourceWorldWidth_);const f=Math.min(E[0][0],E[1][0],E[2][0]);Math.max(E[0][0],E[1][0],E[2][0])-f<this.sourceWorldWidth_/2&&(m.source=E)}})}a={}}addTriangle_(t,e,i,n,s,o){this.triangles_.push({source:[n,s,o],target:[t,e,i]})}addQuad_(t,e,i,n,s,o,a,c,h){const u=Nt([s,o,a,c]),_=this.sourceWorldWidth_?G(u)/this.sourceWorldWidth_:null,R=this.sourceWorldWidth_,w=this.sourceProj_.canWrapX()&&_>.5&&_<1;let l=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const p=Nt([t,e,i,n]);l=G(p)/this.targetWorldWidth_>qt||l}!w&&this.sourceProj_.isGlobal()&&_&&(l=_>qt||l)}if(!l&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!te(u,this.maxSourceExtent_))return;let d=0;if(!l&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(c[0])||!isFinite(c[1]))){if(h>0)l=!0;else if(d=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(c[0])||!isFinite(c[1])?1:0),d!=1&&d!=2&&d!=4&&d!=8)return}if(h>0){if(!l){const p=[(t[0]+i[0])/2,(t[1]+i[1])/2],x=this.transformInv_(p);let g;w?g=(Et(s[0],R)+Et(a[0],R))/2-Et(x[0],R):g=(s[0]+a[0])/2-x[0];const m=(s[1]+a[1])/2-x[1];l=g*g+m*m>this.errorThresholdSquared_}if(l){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const p=[(e[0]+i[0])/2,(e[1]+i[1])/2],x=this.transformInv_(p),g=[(n[0]+t[0])/2,(n[1]+t[1])/2],m=this.transformInv_(g);this.addQuad_(t,e,p,g,s,o,x,m,h-1),this.addQuad_(g,p,i,n,m,x,a,c,h-1)}else{const p=[(t[0]+e[0])/2,(t[1]+e[1])/2],x=this.transformInv_(p),g=[(i[0]+n[0])/2,(i[1]+n[1])/2],m=this.transformInv_(g);this.addQuad_(t,p,g,n,s,x,m,c,h-1),this.addQuad_(p,e,i,g,x,o,a,m,h-1)}return}}if(w){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}d&11||this.addTriangle_(t,i,n,s,a,c),d&14||this.addTriangle_(t,i,e,s,a,o),d&&(d&13||this.addTriangle_(e,n,t,o,c,s),d&7||this.addTriangle_(e,n,i,o,c,a))}calculateSourceExtent(){const t=At();return this.triangles_.forEach(function(e,i,n){const s=e.source;St(t,s[0]),St(t,s[1]),St(t,s[2])}),t}getTriangles(){return this.triangles_}}const ce=li;let Lt;const $=[];function Ht(r,t,e,i,n){r.beginPath(),r.moveTo(0,0),r.lineTo(t,e),r.lineTo(i,n),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(t,i)+1,Math.max(e,n)),r.restore()}function Pt(r,t){return Math.abs(r[t*4]-210)>2||Math.abs(r[t*4+3]-.75*255)>2}function ci(){if(Lt===void 0){const r=st(6,6,$);r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",Ht(r,4,5,4,0),Ht(r,4,5,0,5);const t=r.getImageData(0,0,3,3).data;Lt=Pt(t,0)||Pt(t,4)||Pt(t,8),ut(r),$.push(r.canvas)}return Lt}function Qt(r,t,e,i){const n=De(e,t,r);let s=Bt(t,i,e);const o=t.getMetersPerUnit();o!==void 0&&(s*=o);const a=r.getMetersPerUnit();a!==void 0&&(s/=a);const c=r.getExtent();if(!c||Gt(c,n)){const h=Bt(r,s,n)/s;isFinite(h)&&h>0&&(s/=h)}return s}function he(r,t,e,i){const n=Pe(e);let s=Qt(r,t,n,i);return(!isFinite(s)||s<=0)&&ve(e,function(o){return s=Qt(r,t,o,i),isFinite(s)&&s>0}),s}function ue(r,t,e,i,n,s,o,a,c,h,u,_,R,w){const l=st(Math.round(e*r),Math.round(e*t),$);if(_||(l.imageSmoothingEnabled=!1),c.length===0)return l.canvas;l.scale(e,e);function d(f){return Math.round(f*e)/e}l.globalCompositeOperation="lighter";const p=At();c.forEach(function(f,I,F){Ie(p,f.extent)});let x;const g=e/i,m=(_?1:1+Math.pow(2,-24))/g;if(!R||c.length!==1||h!==0){if(x=st(Math.round(G(p)*g),Math.round(lt(p)*g),$),_||(x.imageSmoothingEnabled=!1),n&&w){const f=(n[0]-p[0])*g,I=-(n[3]-p[3])*g,F=G(n)*g,y=lt(n)*g;x.rect(f,I,F,y),x.clip()}c.forEach(function(f,I,F){if(f.image.width>0&&f.image.height>0){if(f.clipExtent){x.save();const v=(f.clipExtent[0]-p[0])*g,P=-(f.clipExtent[3]-p[3])*g,C=G(f.clipExtent)*g,z=lt(f.clipExtent)*g;x.rect(_?v:Math.round(v),_?P:Math.round(P),_?C:Math.round(v+C)-Math.round(v),_?z:Math.round(P+z)-Math.round(P)),x.clip()}const y=(f.extent[0]-p[0])*g,L=-(f.extent[3]-p[3])*g,D=G(f.extent)*g,M=lt(f.extent)*g;x.drawImage(f.image,h,h,f.image.width-2*h,f.image.height-2*h,_?y:Math.round(y),_?L:Math.round(L),_?D:Math.round(y+D)-Math.round(y),_?M:Math.round(L+M)-Math.round(L)),f.clipExtent&&x.restore()}})}const E=Ct(o);return a.getTriangles().forEach(function(f,I,F){const y=f.source,L=f.target;let D=y[0][0],M=y[0][1],v=y[1][0],P=y[1][1],C=y[2][0],z=y[2][1];const S=d((L[0][0]-E[0])/s),j=d(-(L[0][1]-E[1])/s),U=d((L[1][0]-E[0])/s),K=d(-(L[1][1]-E[1])/s),X=d((L[2][0]-E[0])/s),O=d(-(L[2][1]-E[1])/s),A=D,q=M;D=0,M=0,v-=A,P-=q,C-=A,z-=q;const it=[[v,P,0,0,U-S],[C,z,0,0,X-S],[0,0,v,P,K-j],[0,0,C,z,O-j]],W=Le(it);if(!W)return;if(l.save(),l.beginPath(),ci()||!_){l.moveTo(U,K);const Y=4,H=S-U,nt=j-K;for(let B=0;B<Y;B++)l.lineTo(U+d((B+1)*H/Y),K+d(B*nt/(Y-1))),B!=Y-1&&l.lineTo(U+d((B+1)*H/Y),K+d((B+1)*nt/(Y-1)));l.lineTo(X,O)}else l.moveTo(U,K),l.lineTo(S,j),l.lineTo(X,O);l.clip(),l.transform(W[0],W[2],W[1],W[3],S,j),l.translate(p[0]-A,p[3]-q);let b;if(x)b=x.canvas,l.scale(m,-m);else{const Y=c[0],H=Y.extent;b=Y.image,l.scale(G(H)/b.width,-lt(H)/b.height)}l.drawImage(b,0,0),l.restore()}),x&&(ut(x),$.push(x.canvas)),u&&(l.save(),l.globalCompositeOperation="source-over",l.strokeStyle="black",l.lineWidth=1,a.getTriangles().forEach(function(f,I,F){const y=f.target,L=(y[0][0]-E[0])/s,D=-(y[0][1]-E[1])/s,M=(y[1][0]-E[0])/s,v=-(y[1][1]-E[1])/s,P=(y[2][0]-E[0])/s,C=-(y[2][1]-E[1])/s;l.beginPath(),l.moveTo(M,v),l.lineTo(L,D),l.lineTo(P,C),l.closePath(),l.stroke()}),l.restore()),l.canvas}class hi extends Xt{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:t.interpolate,transition:t.transition}),this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=t.sourceProj,i=e.getExtent(),n=t.sourceTileGrid.getExtent();this.clipExtent_=e.canWrapX()?n?N(i,n):i:n;const s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),o=this.targetTileGrid_.getExtent();let a=this.sourceTileGrid_.getExtent();const c=o?N(s,o):s;if(ht(c)===0){this.state=T.EMPTY;return}i&&(a?a=N(a,i):a=i);const h=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),u=t.targetProj,_=he(e,u,c,h);if(!isFinite(_)||_<=0){this.state=T.EMPTY;return}const R=t.errorThreshold!==void 0?t.errorThreshold:le;if(this.triangulation_=new ce(e,u,c,a,_*R,h),this.triangulation_.getTriangles().length===0){this.state=T.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(_);let w=this.triangulation_.calculateSourceExtent();if(a&&(e.canWrapX()?(w[1]=dt(w[1],a[1],a[3]),w[3]=dt(w[3],a[1],a[3])):w=N(w,a)),!ht(w))this.state=T.EMPTY;else{let l=0,d=0;e.canWrapX()&&(l=G(i),d=Math.floor((w[0]-i[0])/l)),ie(w.slice(),e,!0).forEach(x=>{const g=this.sourceTileGrid_.getTileRangeForExtentAndZ(x,this.sourceZ_),m=t.getTileFunction;for(let E=g.minX;E<=g.maxX;E++)for(let f=g.minY;f<=g.maxY;f++){const I=m(this.sourceZ_,E,f,this.pixelRatio_);if(I){const F=d*l;this.sourceTiles_.push({tile:I,offset:F})}}++d}),this.sourceTiles_.length===0&&(this.state=T.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];let e=!1;if(this.sourceTiles_.forEach(l=>{var j;const d=l.tile;if(!d||d.getState()!==T.LOADED)return;const p=d.getSize(),x=this.gutter_;let g;const m=ii(d.getData());m?g=m:(e=!0,g=si(yt(d.getData())));const E=[p[0]+2*x,p[1]+2*x],f=g instanceof Float32Array,I=E[0]*E[1],F=f?Float32Array:Uint8ClampedArray,y=new F(g.buffer),L=F.BYTES_PER_ELEMENT,D=L*y.length/I,M=y.byteLength/E[1],v=Math.floor(M/L/E[0]),P=I*v;let C=y;if(y.length!==P){C=new F(P);let U=0,K=0;const X=E[0]*v;for(let O=0;O<E[1];++O){for(let A=0;A<X;++A)C[U++]=y[K+A];K+=M/L}}const z=this.sourceTileGrid_.getTileCoordExtent(d.tileCoord);z[0]+=l.offset,z[2]+=l.offset;const S=(j=this.clipExtent_)==null?void 0:j.slice();S&&(S[0]+=l.offset,S[2]+=l.offset),t.push({extent:z,clipExtent:S,data:new Uint8ClampedArray(C.buffer),dataType:F,bytesPerPixel:D,pixelSize:E})}),this.sourceTiles_.length=0,t.length===0){this.state=T.ERROR,this.changed();return}const i=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(i),s=typeof n=="number"?n:n[0],o=typeof n=="number"?n:n[1],a=this.targetTileGrid_.getResolution(i),c=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let u,_;const R=t[0].bytesPerPixel,w=Math.ceil(R/3);for(let l=w-1;l>=0;--l){const d=[];for(let f=0,I=t.length;f<I;++f){const F=t[f],y=F.data,L=F.pixelSize,D=L[0],M=L[1],v=st(D,M,$),P=v.createImageData(D,M),C=P.data;let z=l*3;for(let S=0,j=C.length;S<j;S+=4)C[S]=y[z],C[S+1]=y[z+1],C[S+2]=y[z+2],C[S+3]=255,z+=R;v.putImageData(P,0,0),d.push({extent:F.extent,clipExtent:F.clipExtent,image:v.canvas})}const p=ue(s,o,this.pixelRatio_,c,this.sourceTileGrid_.getExtent(),a,h,this.triangulation_,d,this.gutter_,!1,!1,!1);for(let f=0,I=d.length;f<I;++f){const y=d[f].image.getContext("2d");ut(y),$.push(y.canvas)}const x=p.getContext("2d"),g=x.getImageData(0,0,p.width,p.height);ut(x),$.push(p),u||(_=new Uint8ClampedArray(R*g.width*g.height),u=new t[0].dataType(_.buffer));const m=g.data;let E=l*3;for(let f=0,I=m.length;f<I;f+=4)m[f+3]===255?(_[E]=m[f],_[E+1]=m[f+1],_[E+2]=m[f+2]):(_[E]=0,_[E+1]=0,_[E+2]=0),E+=R}if(e){const l=st(s,o),d=new ImageData(u,s);l.putImageData(d,0,0),this.reprojData_=l.canvas}else this.reprojData_=u;this.reprojSize_=[Math.round(s*this.pixelRatio_),Math.round(o*this.pixelRatio_)],this.state=T.LOADED,this.changed()}load(){if(this.state!==T.IDLE&&this.state!==T.ERROR)return;this.state=T.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(i!==T.IDLE&&i!==T.LOADING)return;t++;const n=ee(e,wt.CHANGE,()=>{const s=e.getState();(s==T.LOADED||s==T.ERROR||s==T.EMPTY)&&(pt(n),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(n)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e}){e.getState()==T.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(pt),this.sourcesListenerKeys_=null}}const ui=hi;class di extends Yt{constructor(t,e,i,n,s,o,a,c,h,u,_,R){super(s,T.IDLE,R),this.renderEdges_=_!==void 0?_:!1,this.pixelRatio_=a,this.gutter_=c,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const w=n.getTileCoordExtent(this.wrappedTileCoord_),l=this.targetTileGrid_.getExtent();let d=this.sourceTileGrid_.getExtent();const p=l?N(w,l):w;if(ht(p)===0){this.state=T.EMPTY;return}const x=t.getExtent();x&&(d?d=N(d,x):d=x);const g=n.getResolution(this.wrappedTileCoord_[0]),m=he(t,i,p,g);if(!isFinite(m)||m<=0){this.state=T.EMPTY;return}const E=u!==void 0?u:le;if(this.triangulation_=new ce(t,i,p,d,m*E,g),this.triangulation_.getTriangles().length===0){this.state=T.EMPTY;return}this.sourceZ_=e.getZForResolution(m);let f=this.triangulation_.calculateSourceExtent();if(d&&(t.canWrapX()?(f[1]=dt(f[1],d[1],d[3]),f[3]=dt(f[3],d[1],d[3])):f=N(f,d)),!ht(f))this.state=T.EMPTY;else{let I=0,F=0;t.canWrapX()&&(I=G(x),F=Math.floor((f[0]-x[0])/I)),ie(f.slice(),t,!0).forEach(L=>{const D=e.getTileRangeForExtentAndZ(L,this.sourceZ_);for(let M=D.minX;M<=D.maxX;M++)for(let v=D.minY;v<=D.maxY;v++){const P=h(this.sourceZ_,M,v,a);if(P){const C=F*I;this.sourceTiles_.push({tile:P,offset:C})}}++F}),this.sourceTiles_.length===0&&(this.state=T.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var n;const i=e.tile;if(i&&i.getState()==T.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);s[0]+=e.offset,s[2]+=e.offset;const o=(n=this.clipExtent_)==null?void 0:n.slice();o&&(o[0]+=e.offset,o[2]+=e.offset),t.push({extent:s,clipExtent:o,image:i.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=T.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),c=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=ue(n,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,c,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=T.LOADED}this.changed()}load(){if(this.state==T.IDLE){this.state=T.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(i==T.IDLE||i==T.LOADING){t++;const n=ee(e,wt.CHANGE,s=>{const o=e.getState();(o==T.LOADED||o==T.ERROR||o==T.EMPTY)&&(pt(n),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(n)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},i,n){e.getState()==T.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(pt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(ut(this.canvas_.getContext("2d")),$.push(this.canvas_),this.canvas_=null),super.release()}}const Ot=di;function vt(r,t,e,i){return`${r},${He(t,e,i)}`}function Dt(r,t,e){if(!(e in r))return r[e]=new Set([t]),!0;const i=r[e],n=i.has(t);return n||i.add(t),!n}function gi(r,t,e){const i=r[e];return i?i.delete(t):!1}function Vt(r,t){const e=r.layerStatesArray[r.layerIndex];e.extent&&(t=N(t,zt(e.extent,r.viewState.projection)));const i=e.layer.getRenderSource();if(!i.getWrapX()){const n=i.getTileGridForProjection(r.viewState.projection).getExtent();n&&(t=N(t,n))}return t}class fi extends Me{constructor(t,e){super(t),e=e||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=At(),this.tempTileRange_=new ae(0,0,0,0),this.tempTileCoord_=Rt(0,0,0);const i=e.cacheSize!==void 0?e.cacheSize:512;this.tileCache_=new qe(i),this.renderedProjection_=void 0,this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getOrCreateTile(t,e,i,n){const s=this.tileCache_,a=this.getLayer().getSource(),c=vt(a.getKey(),t,e,i);let h;if(s.containsKey(c))h=s.get(c);else{if(h=a.getTile(t,e,i,n.pixelRatio,n.viewState.projection),!h)return null;s.set(c,h)}return h}getTile(t,e,i,n){const s=this.getOrCreateTile(t,e,i,n);return s||null}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),n=$t(e.pixelToCoordinateTransform,t.slice()),s=i.getExtent();if(s&&!Gt(s,n))return null;const o=e.viewState,a=i.getRenderSource(),c=a.getTileGridForProjection(o.projection),h=a.getTilePixelRatio(e.pixelRatio);for(let u=c.getZForResolution(o.resolution);u>=c.getMinZoom();--u){const _=c.getTileCoordForCoordAndZ(n,u),R=this.getTile(u,_[1],_[2],e);if(!R||R.getState()!==T.LOADED)continue;const w=c.getOrigin(u),l=et(c.getTileSize(u)),d=c.getResolution(u);let p;if(R instanceof re||R instanceof Ot)p=R.getImage();else if(R instanceof Xt){if(p=yt(R.getData()),!p)continue}else continue;const x=Math.floor(h*((n[0]-w[0])/d-_[1]*l[0])),g=Math.floor(h*((w[1]-n[1])/d-_[2]*l[1])),m=Math.round(h*a.getGutterForProjection(o.projection));return this.getImageData(p,x+m,g+m)}return null}prepareFrame(t){this.renderedProjection_?t.viewState.projection!==this.renderedProjection_&&(this.tileCache_.clear(),this.renderedProjection_=t.viewState.projection):this.renderedProjection_=t.viewState.projection;const e=this.getLayer().getSource();if(!e)return!1;const i=e.getRevision();return this.renderedRevision_?this.renderedRevision_!==i&&(this.renderedRevision_=i,this.renderedSourceKey_===e.getKey()&&this.tileCache_.clear()):this.renderedRevision_=i,!0}enqueueTiles(t,e,i,n,s){const o=t.viewState,a=this.getLayer(),c=a.getRenderSource(),h=c.getTileGridForProjection(o.projection),u=k(c);u in t.wantedTiles||(t.wantedTiles[u]={});const _=t.wantedTiles[u],R=a.getMapInternal(),w=Math.max(i-s,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),R?R.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),c.zDirection));for(let l=i;l>=w;--l){const d=h.getTileRangeForExtentAndZ(e,l,this.tempTileRange_),p=h.getResolution(l);for(let x=d.minX;x<=d.maxX;++x)for(let g=d.minY;g<=d.maxY;++g){const m=this.getTile(l,x,g,t);if(!m||!Dt(n,m,l))continue;const f=m.getKey();if(_[f]=!0,m.getState()===T.IDLE&&!t.tileQueue.isKeyQueued(f)){const I=Rt(l,x,g,this.tempTileCoord_);t.tileQueue.enqueue([m,u,h.getTileCoordCenter(I),p])}}}}findStaleTile_(t,e){const i=this.tileCache_,n=t[0],s=t[1],o=t[2],a=this.getStaleKeys();for(let c=0;c<a.length;++c){const h=vt(a[c],n,s,o);if(i.containsKey(h)){const u=i.get(h);if(u.getState()===T.LOADED)return u.endTransition(k(this)),Dt(e,u,n),!0}}return!1}findAltTiles_(t,e,i,n){const s=t.getTileRangeForTileCoordAndZ(e,i,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileCache_,h=this.getLayer().getRenderSource().getKey();for(let u=s.minX;u<=s.maxX;++u)for(let _=s.minY;_<=s.maxY;++_){const R=vt(h,i,u,_);let w=!1;if(a.containsKey(R)){const l=a.get(R);l.getState()===T.LOADED&&(Dt(n,l,i),w=!0)}w||(o=!1)}return o}renderFrame(t,e){this.renderComplete=!0;const i=t.layerStatesArray[t.layerIndex],n=t.viewState,s=n.projection,o=n.resolution,a=n.center,c=t.pixelRatio,h=this.getLayer(),u=h.getSource(),_=u.getRevision(),R=u.getTileGridForProjection(s),w=R.getZForResolution(o,u.zDirection),l=R.getResolution(w),d=u.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==d&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=d):this.renderedSourceKey_=d;let p=t.extent;const x=u.getTilePixelRatio(c);this.prepareContainer(t,e);const g=this.context.canvas.width,m=this.context.canvas.height,E=i.extent&&zt(i.extent);E&&(p=N(p,zt(i.extent)));const f=l*g/2/x,I=l*m/2/x,F=[a[0]-f,a[1]-I,a[0]+f,a[1]+I],y={};this.renderedTiles.length=0;const L=h.getPreload();if(t.nextExtent){const X=R.getZForResolution(n.nextResolution,u.zDirection),O=Vt(t,t.nextExtent);this.enqueueTiles(t,O,X,y,L)}const D=Vt(t,p);if(this.enqueueTiles(t,D,w,y,0),L>0&&setTimeout(()=>{this.enqueueTiles(t,D,w-1,y,L-1)},0),!(w in y))return this.container;const M=k(this),v=t.time;for(const X of y[w]){const O=X.getState();if((X instanceof Ot||X instanceof ui)&&O===T.EMPTY)continue;const A=X.tileCoord;if(O===T.LOADED&&X.getAlpha(M,v)===1){X.endTransition(M);continue}if(this.renderComplete=!1,this.findStaleTile_(A,y)){gi(y,X,w),t.animate=!0;continue}if(this.findAltTiles_(R,A,w+1,y))continue;const W=R.getMinZoom();for(let b=w-1;b>=W&&!this.findAltTiles_(R,A,b,y);--b);}const P=l/o*c/x,C=this.getRenderContext(t);ze(this.tempTransform,g/2,m/2,P,P,0,-g/2,-m/2),i.extent&&this.clipUnrotated(C,t,E),u.getInterpolate()||(C.imageSmoothingEnabled=!1),this.preRender(C,t);const z=Object.keys(y).map(Number);z.sort(Xe);let S;const j=[],U=[];for(let X=z.length-1;X>=0;--X){const O=z[X],A=u.getTilePixelSize(O,c,s),it=R.getResolution(O)/l,W=A[0]*it*P,b=A[1]*it*P,Y=R.getTileCoordForCoordAndZ(Ct(F),O),H=R.getTileCoordExtent(Y),nt=$t(this.tempTransform,[x*(H[0]-F[0])/l,x*(F[3]-H[3])/l]),B=x*u.getGutterForProjection(s);for(const ct of y[O]){if(ct.getState()!==T.LOADED)continue;const Ut=ct.tileCoord,Kt=Y[1]-Ut[1],_e=Math.round(nt[0]-(Kt-1)*W),Wt=Y[2]-Ut[2],Te=Math.round(nt[1]-(Wt-1)*b),Q=Math.round(nt[0]-Kt*W),V=Math.round(nt[1]-Wt*b),gt=_e-Q,ft=Te-V,kt=z.length===1;let Ft=!1;S=[Q,V,Q+gt,V,Q+gt,V+ft,Q,V+ft];for(let _t=0,me=j.length;_t<me;++_t)if(!kt&&O<U[_t]){const Z=j[_t];te([Q,V,Q+gt,V+ft],[Z[0],Z[3],Z[4],Z[7]])&&(Ft||(C.save(),Ft=!0),C.beginPath(),C.moveTo(S[0],S[1]),C.lineTo(S[2],S[3]),C.lineTo(S[4],S[5]),C.lineTo(S[6],S[7]),C.moveTo(Z[6],Z[7]),C.lineTo(Z[4],Z[5]),C.lineTo(Z[2],Z[3]),C.lineTo(Z[0],Z[1]),C.clip())}j.push(S),U.push(O),this.drawTile(ct,t,Q,V,gt,ft,B,kt),Ft&&C.restore(),this.renderedTiles.unshift(ct),this.updateUsedTiles(t.usedTiles,u,ct)}}this.renderedRevision=_,this.renderedResolution=l,this.extentChanged=!this.renderedExtent_||!Oe(this.renderedExtent_,F),this.renderedExtent_=F,this.renderedPixelRatio=c,this.renderedProjection=s,this.postRender(this.context,t),i.extent&&C.restore(),C.imageSmoothingEnabled=!0;const K=(X,O)=>{const A=k(u),q=O.wantedTiles[A],it=q?Object.keys(q).length:0;this.updateCacheSize(it),this.tileCache_.expireCache()};return t.postRenderFunctions.push(K),this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,e,i,n,s,o,a,c){let h;if(t instanceof Xt){if(h=yt(t.getData()),!h)throw new Error("Rendering array data is not yet supported")}else h=this.getTileImage(t);if(!h)return;const u=this.getRenderContext(e),_=k(this),R=e.layerStatesArray[e.layerIndex],w=R.opacity*(c?t.getAlpha(_,e.time):1),l=w!==u.globalAlpha;l&&(u.save(),u.globalAlpha=w),u.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,n,s,o),l&&u.restore(),w!==R.opacity?e.animate=!0:c&&t.endTransition(_)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,e,i){const n=k(e);n in t||(t[n]={}),t[n][i.getKey()]=!0}}const _i=fi;class Ti extends ei{constructor(t){super(t)}createRenderer(){return new _i(this,{cacheSize:this.getCacheSize()})}}const Ki=Ti,Mt={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},at=[0,0,0],J=5;class mi{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,tt(Ae(this.resolutions_,(n,s)=>s-n,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let n=0,s=this.resolutions_.length-1;n<s;++n)if(!e)e=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,tt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Ct(i)),tt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,tt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:ne,tt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((n,s)=>{const o=new ae(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const n=this.getTileRangeForExtentAndZ(t,e);for(let s=n.minX,o=n.maxX;s<=o;++s)for(let a=n.minY,c=n.maxY;a<=c;++a)i([e,s,a])}forEachTileCoordParentTileRange(t,e,i,n){let s,o,a,c=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):c=this.getTileCoordExtent(t,n);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=rt(o,o,a,a,i)):s=this.getTileRangeForExtentAndZ(c,h,i),e(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,o=t[2]*2;return rt(s,s+1,o,o+1,e)}const n=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const n=t[0],s=t[1],o=t[2];if(e===n)return rt(s,o,s,o,i);if(this.zoomFactor_){const c=Math.pow(this.zoomFactor_,e-n),h=Math.floor(s*c),u=Math.floor(o*c);if(e<n)return rt(h,h,u,u,i);const _=Math.floor(c*(s+1))-1,R=Math.floor(c*(o+1))-1;return rt(h,_,u,R,i)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,at);const n=at[1],s=at[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,at);const o=at[1],a=at[2];return rt(n,o,s,a,i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),n=et(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*i,e[1]-(t[2]+.5)*n[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=et(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*s[0]*n,a=i[1]-(t[2]+1)*s[1]*n,c=o+s[0]*n,h=a+s[1]*n;return se(o,a,c,h,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,n,s){const o=this.getZForResolution(i),a=i/this.getResolution(o),c=this.getOrigin(o),h=et(this.getTileSize(o),this.tmpSize_);let u=a*(t-c[0])/i/h[0],_=a*(c[1]-e)/i/h[1];return n?(u=Tt(u,J)-1,_=Tt(_,J)-1):(u=mt(u,J),_=mt(_,J)),Rt(o,u,_,s)}getTileCoordForXYAndZ_(t,e,i,n,s){const o=this.getOrigin(i),a=this.getResolution(i),c=et(this.getTileSize(i),this.tmpSize_);let h=(t-o[0])/a/c[0],u=(o[1]-e)/a/c[1];return n?(h=Tt(h,J)-1,u=Tt(u,J)-1):(h=mt(h,J),u=mt(u,J)),Rt(i,h,u,s)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=Ge(this.resolutions_,t,e||0);return dt(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return je(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let n=this.minZoom;n<e;++n)i[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=i}}const de=mi;function ge(r){let t=r.getDefaultTileGrid();return t||(t=Ri(r),r.setDefaultTileGrid(t)),t}function xi(r,t,e){const i=t[0],n=r.getTileCoordCenter(t),s=bt(e);if(!Gt(s,n)){const o=G(s),a=Math.ceil((s[0]-n[0])/o);return n[0]+=o*a,r.getTileCoordForCoordAndZ(n,i)}return t}function Ei(r,t,e,i){i=i!==void 0?i:"top-left";const n=fe(r,t,e);return new de({extent:r,origin:be(r,i),resolutions:n,tileSize:e})}function pi(r){const t=r||{},e=t.extent||jt("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:fe(e,t.maxZoom,t.tileSize,t.maxResolution)};return new de(i)}function fe(r,t,e,i){t=t!==void 0?t:Ze,e=et(e!==void 0?e:ne);const n=lt(r),s=G(r);i=i>0?i:Math.max(s/e[0],n/e[1]);const o=t+1,a=new Array(o);for(let c=0;c<o;++c)a[c]=i/Math.pow(2,c);return a}function Ri(r,t,e,i){const n=bt(r);return Ei(n,t,e,i)}function bt(r){r=jt(r);let t=r.getExtent();if(!t){const e=180*Ye.degrees/r.getMetersPerUnit();t=se(-e,-e,e,e)}return t}class yi extends Ue{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&et(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||k(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,n,s){return Jt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:ge(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const n=this.getTileGridForProjection(i),s=this.getTilePixelRatio(e),o=et(n.getTileSize(t),this.tmpSize);return s==1?o:Ke(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=xi(i,t,e)),Je(t,i)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class wi extends We{constructor(t,e){super(t),this.tile=e}}const Ci=yi,Fi=/\{z\}/g,Si=/\{x\}/g,Ii=/\{y\}/g,Li=/\{-y\}/g;function Pi(r,t,e,i,n){return r.replace(Fi,t.toString()).replace(Si,e.toString()).replace(Ii,i.toString()).replace(Li,function(){if(n===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(n-i).toString()})}function vi(r){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(r);if(e){const i=e[1].charCodeAt(0),n=e[2].charCodeAt(0);let s;for(s=i;s<=n;++s)t.push(r.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(r),e){const i=parseInt(e[2],10);for(let n=parseInt(e[1],10);n<=i;n++)t.push(r.replace(e[0],n.toString()));return t}return t.push(r),t}function Di(r,t){return function(e,i,n){if(!e)return;let s;const o=e[0];if(t){const a=t.getFullTileRange(o);a&&(s=a.getHeight()-1)}return Pi(r,o,e[1],e[2],s)}}function Mi(r,t){const e=r.length,i=new Array(e);for(let n=0;n<e;++n)i[n]=Di(r[n],t);return zi(i)}function zi(r){return r.length===1?r[0]:function(t,e,i){if(!t)return;const n=Qe(t),s=Et(n,r.length);return r[s](t,e,i)}}class Zt extends Ci{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Zt.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=k(e),n=e.getState();let s;n==T.LOADING?(this.tileLoadingKeys_[i]=!0,s=Mt.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==T.ERROR?Mt.TILELOADERROR:n==T.LOADED?Mt.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new wi(s,e))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=vi(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Mi(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}}const Xi=Zt;class Oi extends Xi{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Ai,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:re,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!It(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||It(e,t)))return this.tileGrid;const i=k(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=ge(t)),this.tileGridForProjection[i]}createTile_(t,e,i,n,s,o){const a=[t,e,i],c=this.getTileCoordForTileUrlFunction(a,s),h=c?this.tileUrlFunction(c,n,s):void 0,u=new this.tileClass(a,h!==void 0?T.IDLE:T.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=o,u.addEventListener(wt.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,e,i,n,s){const o=this.getProjection();if(!o||!s||It(o,s))return this.getTileInternal(t,e,i,n,o||s);const a=[t,e,i],c=this.getKey(),h=this.getTileGridForProjection(o),u=this.getTileGridForProjection(s),_=this.getTileCoordForTileUrlFunction(a,s),R=new Ot(o,h,s,u,a,_,this.getTilePixelRatio(n),this.getGutter(),(w,l,d,p)=>this.getTileInternal(w,l,d,p,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return R.key=c,R}getTileInternal(t,e,i,n,s){const o=this.getKey();return this.createTile_(t,e,i,n,s,o)}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,e){const i=jt(t);if(i){const n=k(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}}}function Ai(r,t){r.getImage().src=t}const Gi=Oi;class ji extends Gi{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:pi({extent:bt(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const Yi=ji,bi='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Zi extends Yi{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[bi];const i=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",n=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:n,wrapX:t.wrapX,zDirection:t.zDirection})}}const Wi=Zi;export{bi as A,Wi as O,Ki as T,Yi as X};
//# sourceMappingURL=OSM-f284ffe5.js.map
