import{l as _t,E as Ie,m,n as Qe,o as Tt,q as mt,r as Fe,s as Z,L as xt,u as Et,v as D,w as fe,x as Ct,y as pt,z as Ft,A as ye,c as Ze,H as Ve,I as ue,J as xe,K as Le,N as yt,O as ge,P as Rt,h as wt,Q as Pt,U as It,W as be,X as ve,Y as de,Z as Lt,_ as Ue,$ as vt,a0 as Re,a1 as Xt,a2 as We,a3 as K,a4 as ke,a5 as Ke,a6 as G,a7 as Ne,a8 as St,a9 as Ot,aa as jt,ab as zt,ac as Dt,ad as Je,ae as we,af as Mt,ag as Yt,ah as ae,ai as he,aj as Xe,ak as At,al as Gt,am as Zt,an as bt,ao as ie,ap as Ut,aq as Wt}from"./networklayer-f7e04c8c.js";class kt extends _t{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(Ie.CHANGE)}release(){this.state===m.ERROR&&this.setState(m.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let e=this.interimTile;do{if(e.getState()==m.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){if(!this.interimTile)return;let e=this.interimTile,t=this;do{if(e.getState()==m.LOADED){e.interimTile=null;break}else e.getState()==m.LOADING?t=e:e.getState()==m.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==m.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){Qe()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const n=t-i+1e3/60;return n>=this.transition_?1:Tt(n/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}const et=kt;class Kt extends et{constructor(e,t,i,n,s,r){super(e,t,r),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=m.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=m.ERROR,this.unlistenImage_(),this.image_=Nt(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=m.LOADED:this.state=m.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==m.ERROR&&(this.state=m.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==m.IDLE&&(this.state=m.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=mt(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Nt(){const o=Fe(1,1);return o.fillStyle="rgba(0,0,0,0)",o.fillRect(0,0,1,1),o.canvas}const tt=Kt;class qt{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return Z(i!==void 0,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return Z(t!==void 0,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){if(this.containsKey(e))return this.entries_[e].value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){Z(!(e in this.entries_),16);const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}const $t=qt;function qe(o,e,t,i){return i!==void 0?(i[0]=o,i[1]=e,i[2]=t,i):[o,e,t]}function _e(o,e,t){return o+"/"+e+"/"+t}function it(o){return _e(o[0],o[1],o[2])}function Bt(o){return o.split("/").map(Number)}function Ht(o){return(o[1]<<o[0])+o[2]}function Qt(o,e){const t=o[0],i=o[1],n=o[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(i,n):!0}class Vt extends $t{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=Bt(e)[0];this.forEach(function(n){n.tileCoord[0]!==i&&(this.remove(it(n.tileCoord)),n.release())}.bind(this))}}const nt=Vt;class st{constructor(e,t,i,n){this.minX=e,this.maxX=t,this.minY=i,this.maxY=n}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function te(o,e,t,i,n){return n!==void 0?(n.minX=o,n.maxX=e,n.minY=t,n.maxY=i,n):new st(o,e,t,i)}const rt=st,ce={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Jt extends xt{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(ce.PRELOAD)}setPreload(e){this.set(ce.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(ce.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(ce.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const ei=Jt,ti=.5,ii=10,$e=.25;class ni{constructor(e,t,i,n,s,r){this.sourceProj_=e,this.targetProj_=t;let l={};const h=Et(this.targetProj_,this.sourceProj_);this.transformInv_=function(_){const d=_[0]+"/"+_[1];return l[d]||(l[d]=h(_)),l[d]},this.maxSourceExtent_=n,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&D(n)==D(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?D(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?D(this.targetProj_.getExtent()):null;const a=fe(i),c=Ct(i),f=pt(i),u=Ft(i),E=this.transformInv_(a),T=this.transformInv_(c),x=this.transformInv_(f),p=this.transformInv_(u),C=ii+(r?Math.max(0,Math.ceil(Math.log2(ye(i)/(r*r*256*256)))):0);if(this.addQuad_(a,c,f,u,E,T,x,p,C),this.wrapsXInSource_){let _=1/0;this.triangles_.forEach(function(d,g,y){_=Math.min(_,d.source[0][0],d.source[1][0],d.source[2][0])}),this.triangles_.forEach(function(d){if(Math.max(d.source[0][0],d.source[1][0],d.source[2][0])-_>this.sourceWorldWidth_/2){const g=[[d.source[0][0],d.source[0][1]],[d.source[1][0],d.source[1][1]],[d.source[2][0],d.source[2][1]]];g[0][0]-_>this.sourceWorldWidth_/2&&(g[0][0]-=this.sourceWorldWidth_),g[1][0]-_>this.sourceWorldWidth_/2&&(g[1][0]-=this.sourceWorldWidth_),g[2][0]-_>this.sourceWorldWidth_/2&&(g[2][0]-=this.sourceWorldWidth_);const y=Math.min(g[0][0],g[1][0],g[2][0]);Math.max(g[0][0],g[1][0],g[2][0])-y<this.sourceWorldWidth_/2&&(d.source=g)}}.bind(this))}l={}}addTriangle_(e,t,i,n,s,r){this.triangles_.push({source:[n,s,r],target:[e,t,i]})}addQuad_(e,t,i,n,s,r,l,h,a){const c=Ze([s,r,l,h]),f=this.sourceWorldWidth_?D(c)/this.sourceWorldWidth_:null,u=this.sourceWorldWidth_,E=this.sourceProj_.canWrapX()&&f>.5&&f<1;let T=!1;if(a>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const p=Ze([e,t,i,n]);T=D(p)/this.targetWorldWidth_>$e||T}!E&&this.sourceProj_.isGlobal()&&f&&(T=f>$e||T)}if(!T&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Ve(c,this.maxSourceExtent_))return;let x=0;if(!T&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(r[0])||!isFinite(r[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(h[0])||!isFinite(h[1]))){if(a>0)T=!0;else if(x=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(r[0])||!isFinite(r[1])?4:0)+(!isFinite(l[0])||!isFinite(l[1])?2:0)+(!isFinite(h[0])||!isFinite(h[1])?1:0),x!=1&&x!=2&&x!=4&&x!=8)return}if(a>0){if(!T){const p=[(e[0]+i[0])/2,(e[1]+i[1])/2],C=this.transformInv_(p);let _;E?_=(ue(s[0],u)+ue(l[0],u))/2-ue(C[0],u):_=(s[0]+l[0])/2-C[0];const d=(s[1]+l[1])/2-C[1];T=_*_+d*d>this.errorThresholdSquared_}if(T){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const p=[(t[0]+i[0])/2,(t[1]+i[1])/2],C=this.transformInv_(p),_=[(n[0]+e[0])/2,(n[1]+e[1])/2],d=this.transformInv_(_);this.addQuad_(e,t,p,_,s,r,C,d,a-1),this.addQuad_(_,p,i,n,d,C,l,h,a-1)}else{const p=[(e[0]+t[0])/2,(e[1]+t[1])/2],C=this.transformInv_(p),_=[(i[0]+n[0])/2,(i[1]+n[1])/2],d=this.transformInv_(_);this.addQuad_(e,p,_,n,s,C,d,h,a-1),this.addQuad_(p,t,i,_,C,r,l,d,a-1)}return}}if(E){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}x&11||this.addTriangle_(e,i,n,s,l,h),x&14||this.addTriangle_(e,i,t,s,l,r),x&&(x&13||this.addTriangle_(t,n,e,r,h,s),x&7||this.addTriangle_(t,n,i,r,h,l))}calculateSourceExtent(){const e=Le();return this.triangles_.forEach(function(t,i,n){const s=t.source;xe(e,s[0]),xe(e,s[1]),xe(e,s[2])}),e}getTriangles(){return this.triangles_}}const si=ni;let Ee;const ot=[];function Be(o,e,t,i,n){o.beginPath(),o.moveTo(0,0),o.lineTo(e,t),o.lineTo(i,n),o.closePath(),o.save(),o.clip(),o.fillRect(0,0,Math.max(e,i)+1,Math.max(t,n)),o.restore()}function Ce(o,e){return Math.abs(o[e*4]-210)>2||Math.abs(o[e*4+3]-.75*255)>2}function ri(){if(Ee===void 0){const o=document.createElement("canvas").getContext("2d");o.globalCompositeOperation="lighter",o.fillStyle="rgba(210, 0, 0, 0.75)",Be(o,4,5,4,0),Be(o,4,5,0,5);const e=o.getImageData(0,0,3,3).data;Ee=Ce(e,0)||Ce(e,4)||Ce(e,8)}return Ee}function He(o,e,t,i){const n=It(t,e,o);let s=be(e,i,t);const r=e.getMetersPerUnit();r!==void 0&&(s*=r);const l=o.getMetersPerUnit();l!==void 0&&(s/=l);const h=o.getExtent();if(!h||ve(h,n)){const a=be(o,s,n)/s;isFinite(a)&&a>0&&(s/=a)}return s}function oi(o,e,t,i){const n=wt(t);let s=He(o,e,n,i);return(!isFinite(s)||s<=0)&&Pt(t,function(r){return s=He(o,e,r,i),isFinite(s)&&s>0}),s}function li(o,e,t,i,n,s,r,l,h,a,c,f){const u=Fe(Math.round(t*o),Math.round(t*e),ot);if(f||(u.imageSmoothingEnabled=!1),h.length===0)return u.canvas;u.scale(t,t);function E(g){return Math.round(g*t)/t}u.globalCompositeOperation="lighter";const T=Le();h.forEach(function(g,y,R){yt(T,g.extent)});const x=D(T),p=ge(T),C=Fe(Math.round(t*x/i),Math.round(t*p/i));f||(C.imageSmoothingEnabled=!1);const _=t/i;h.forEach(function(g,y,R){const w=g.extent[0]-T[0],P=-(g.extent[3]-T[3]),v=D(g.extent),j=ge(g.extent);g.image.width>0&&g.image.height>0&&C.drawImage(g.image,a,a,g.image.width-2*a,g.image.height-2*a,w*_,P*_,v*_,j*_)});const d=fe(r);return l.getTriangles().forEach(function(g,y,R){const w=g.source,P=g.target;let v=w[0][0],j=w[0][1],N=w[1][0],q=w[1][1],$=w[2][0],ne=w[2][1];const M=E((P[0][0]-d[0])/s),b=E(-(P[0][1]-d[1])/s),F=E((P[1][0]-d[0])/s),O=E(-(P[1][1]-d[1])/s),U=E((P[2][0]-d[0])/s),Y=E(-(P[2][1]-d[1])/s),Q=v,X=j;v=0,j=0,N-=Q,q-=X,$-=Q,ne-=X;const A=[[N,q,0,0,F-M],[$,ne,0,0,U-M],[0,0,N,q,O-b],[0,0,$,ne,Y-b]],L=Rt(A);if(L){if(u.save(),u.beginPath(),ri()||!f){u.moveTo(F,O);const I=4,V=M-F,B=b-O;for(let S=0;S<I;S++)u.lineTo(F+E((S+1)*V/I),O+E(S*B/(I-1))),S!=I-1&&u.lineTo(F+E((S+1)*V/I),O+E((S+1)*B/(I-1)));u.lineTo(U,Y)}else u.moveTo(F,O),u.lineTo(M,b),u.lineTo(U,Y);u.clip(),u.transform(L[0],L[2],L[1],L[3],M,b),u.translate(T[0]-Q,T[3]-X),u.scale(i/t,-i/t),u.drawImage(C.canvas,0,0),u.restore()}}),c&&(u.save(),u.globalCompositeOperation="source-over",u.strokeStyle="black",u.lineWidth=1,l.getTriangles().forEach(function(g,y,R){const w=g.target,P=(w[0][0]-d[0])/s,v=-(w[0][1]-d[1])/s,j=(w[1][0]-d[0])/s,N=-(w[1][1]-d[1])/s,q=(w[2][0]-d[0])/s,$=-(w[2][1]-d[1])/s;u.beginPath(),u.moveTo(j,N),u.lineTo(P,v),u.lineTo(q,$),u.closePath(),u.stroke()}),u.restore()),u.canvas}class ai extends et{constructor(e,t,i,n,s,r,l,h,a,c,f,u){super(s,m.IDLE,{interpolate:!!u}),this.renderEdges_=f!==void 0?f:!1,this.pixelRatio_=l,this.gutter_=h,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=r||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const E=n.getTileCoordExtent(this.wrappedTileCoord_),T=this.targetTileGrid_.getExtent();let x=this.sourceTileGrid_.getExtent();const p=T?de(E,T):E;if(ye(p)===0){this.state=m.EMPTY;return}const C=e.getExtent();C&&(x?x=de(x,C):x=C);const _=n.getResolution(this.wrappedTileCoord_[0]),d=oi(e,i,p,_);if(!isFinite(d)||d<=0){this.state=m.EMPTY;return}const g=c!==void 0?c:ti;if(this.triangulation_=new si(e,i,p,x,d*g,_),this.triangulation_.getTriangles().length===0){this.state=m.EMPTY;return}this.sourceZ_=t.getZForResolution(d);let y=this.triangulation_.calculateSourceExtent();if(x&&(e.canWrapX()?(y[1]=Re(y[1],x[1],x[3]),y[3]=Re(y[3],x[1],x[3])):y=de(y,x)),!ye(y))this.state=m.EMPTY;else{const R=t.getTileRangeForExtentAndZ(y,this.sourceZ_);for(let w=R.minX;w<=R.maxX;w++)for(let P=R.minY;P<=R.maxY;P++){const v=a(this.sourceZ_,w,P,l);v&&this.sourceTiles_.push(v)}this.sourceTiles_.length===0&&(this.state=m.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(function(t,i,n){t&&t.getState()==m.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}.bind(this)),this.sourceTiles_.length=0,e.length===0)this.state=m.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],r=this.targetTileGrid_.getResolution(t),l=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=li(n,s,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),r,h,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=m.LOADED}this.changed()}load(){if(this.state==m.IDLE){this.state=m.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(t,i,n){const s=t.getState();if(s==m.IDLE||s==m.LOADING){e++;const r=Lt(t,Ie.CHANGE,function(l){const h=t.getState();(h==m.LOADED||h==m.ERROR||h==m.EMPTY)&&(Ue(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}.bind(this)),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,n){t.getState()==m.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Ue),this.sourcesListenerKeys_=null}release(){this.canvas_&&(vt(this.canvas_.getContext("2d")),ot.push(this.canvas_),this.canvas_=null),super.release()}}const Pe=ai;class hi extends Xt{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Le(),this.tmpTileRange_=new rt(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),n=t.getUseInterimTilesOnError();return i==m.LOADED||i==m.EMPTY||i==m.ERROR&&!n}getTile(e,t,i,n){const s=n.pixelRatio,r=n.viewState.projection,l=this.getLayer();let a=l.getSource().getTile(e,t,i,s,r);return a.getState()==m.ERROR&&l.getUseInterimTilesOnError()&&l.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=We(t.pixelToCoordinateTransform,e.slice()),s=i.getExtent();if(s&&!ve(s,n))return null;const r=t.pixelRatio,l=t.viewState.projection,h=t.viewState,a=i.getRenderSource(),c=a.getTileGridForProjection(h.projection),f=a.getTilePixelRatio(t.pixelRatio);for(let u=c.getZForResolution(h.resolution);u>=c.getMinZoom();--u){const E=c.getTileCoordForCoordAndZ(n,u),T=a.getTile(u,E[1],E[2],r,l);if(!(T instanceof tt||T instanceof Pe)||T instanceof Pe&&T.getState()===m.EMPTY)return null;if(T.getState()!==m.LOADED)continue;const x=c.getOrigin(u),p=K(c.getTileSize(u)),C=c.getResolution(u),_=Math.floor(f*((n[0]-x[0])/C-E[1]*p[0])),d=Math.floor(f*((x[1]-n[1])/C-E[2]*p[1])),g=Math.round(f*a.getGutterForProjection(h.projection));return this.getImageData(T.getImage(),_+g,d+g)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],n=e.viewState,s=n.projection,r=n.resolution,l=n.center,h=n.rotation,a=e.pixelRatio,c=this.getLayer(),f=c.getSource(),u=f.getRevision(),E=f.getTileGridForProjection(s),T=E.getZForResolution(r,f.zDirection),x=E.getResolution(T);let p=e.extent;const C=e.viewState.resolution,_=f.getTilePixelRatio(a),d=Math.round(D(p)/C*a),g=Math.round(ge(p)/C*a),y=i.extent&&ke(i.extent);y&&(p=de(p,ke(i.extent)));const R=x*d/2/_,w=x*g/2/_,P=[l[0]-R,l[1]-w,l[0]+R,l[1]+w],v=E.getTileRangeForExtentAndZ(p,T),j={};j[T]={};const N=this.createLoadedTileFinder(f,s,j),q=this.tmpExtent,$=this.tmpTileRange_;this.newTiles_=!1;const ne=h?Ke(n.center,C,h,e.size):void 0;for(let A=v.minX;A<=v.maxX;++A)for(let L=v.minY;L<=v.maxY;++L){if(h&&!E.tileCoordIntersectsViewport([T,A,L],ne))continue;const I=this.getTile(T,A,L,e);if(this.isDrawableTile(I)){const S=G(this);if(I.getState()==m.LOADED){j[T][I.tileCoord.toString()]=I;let J=I.inTransition(S);J&&i.opacity!==1&&(I.endTransition(S),J=!1),!this.newTiles_&&(J||!this.renderedTiles.includes(I))&&(this.newTiles_=!0)}if(I.getAlpha(S,e.time)===1)continue}const V=E.getTileCoordChildTileRange(I.tileCoord,$,q);let B=!1;V&&(B=N(T+1,V)),B||E.forEachTileCoordParentTileRange(I.tileCoord,N,$,q)}const M=x/r*a/_;Ne(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/a,1/a,h,-d/2,-g/2);const b=St(this.pixelTransform);this.useContainer(t,b,this.getBackground(e));const F=this.context,O=F.canvas;Ot(this.inversePixelTransform,this.pixelTransform),Ne(this.tempTransform,d/2,g/2,M,M,0,-d/2,-g/2),O.width!=d||O.height!=g?(O.width=d,O.height=g):this.containerReused||F.clearRect(0,0,d,g),y&&this.clipUnrotated(F,e,y),f.getInterpolate()||(F.imageSmoothingEnabled=!1),this.preRender(F,e),this.renderedTiles.length=0;let U=Object.keys(j).map(Number);U.sort(jt);let Y,Q,X;i.opacity===1&&(!this.containerReused||f.getOpaque(e.viewState.projection))?U=U.reverse():(Y=[],Q=[]);for(let A=U.length-1;A>=0;--A){const L=U[A],I=f.getTilePixelSize(L,a,s),B=E.getResolution(L)/x,S=I[0]*B*M,J=I[1]*B*M,Te=E.getTileCoordForCoordAndZ(fe(P),L),je=E.getTileCoordExtent(Te),oe=We(this.tempTransform,[_*(je[0]-P[0])/x,_*(P[3]-je[3])/x]),ct=_*f.getGutterForProjection(s),ze=j[L];for(const ut in ze){const ee=ze[ut],De=ee.tileCoord,Me=Te[1]-De[1],dt=Math.round(oe[0]-(Me-1)*S),Ye=Te[2]-De[2],gt=Math.round(oe[1]-(Ye-1)*J),W=Math.round(oe[0]-Me*S),k=Math.round(oe[1]-Ye*J),se=dt-W,re=gt-k,Ae=T===L,Ge=Ae&&ee.getAlpha(G(this),e.time)!==1;let me=!1;if(!Ge)if(Y){X=[W,k,W+se,k,W+se,k+re,W,k+re];for(let le=0,ft=Y.length;le<ft;++le)if(T!==L&&L<Q[le]){const z=Y[le];Ve([W,k,W+se,k+re],[z[0],z[3],z[4],z[7]])&&(me||(F.save(),me=!0),F.beginPath(),F.moveTo(X[0],X[1]),F.lineTo(X[2],X[3]),F.lineTo(X[4],X[5]),F.lineTo(X[6],X[7]),F.moveTo(z[6],z[7]),F.lineTo(z[4],z[5]),F.lineTo(z[2],z[3]),F.lineTo(z[0],z[1]),F.clip())}Y.push(X),Q.push(L)}else F.clearRect(W,k,se,re);this.drawTileImage(ee,e,W,k,se,re,ct,Ae),Y&&!Ge?(me&&F.restore(),this.renderedTiles.unshift(ee)):this.renderedTiles.push(ee),this.updateUsedTiles(e.usedTiles,f,ee)}}return this.renderedRevision=u,this.renderedResolution=x,this.extentChanged=!this.renderedExtent_||!zt(this.renderedExtent_,P),this.renderedExtent_=P,this.renderedPixelRatio=a,this.renderedProjection=s,this.manageTilePyramid(e,f,E,a,s,p,T,c.getPreload()),this.scheduleExpireCache(e,f),this.postRender(F,e),i.extent&&F.restore(),F.imageSmoothingEnabled=!0,b!==O.style.transform&&(O.style.transform=b),this.container}drawTileImage(e,t,i,n,s,r,l,h){const a=this.getTileImage(e);if(!a)return;const c=G(this),f=t.layerStatesArray[t.layerIndex],u=f.opacity*(h?e.getAlpha(c,t.time):1),E=u!==this.context.globalAlpha;E&&(this.context.save(),this.context.globalAlpha=u),this.context.drawImage(a,l,l,a.width-2*l,a.height-2*l,i,n,s,r),E&&this.context.restore(),u!==f.opacity?t.animate=!0:h&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=function(n,s,r){const l=G(n);l in r.usedTiles&&n.expireCache(r.viewState.projection,r.usedTiles[l])}.bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const n=G(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}manageTilePyramid(e,t,i,n,s,r,l,h,a){const c=G(t);c in e.wantedTiles||(e.wantedTiles[c]={});const f=e.wantedTiles[c],u=e.tileQueue,E=i.getMinZoom(),T=e.viewState.rotation,x=T?Ke(e.viewState.center,e.viewState.resolution,T,e.size):void 0;let p=0,C,_,d,g,y,R;for(R=E;R<=l;++R)for(_=i.getTileRangeForExtentAndZ(r,R,_),d=i.getResolution(R),g=_.minX;g<=_.maxX;++g)for(y=_.minY;y<=_.maxY;++y)T&&!i.tileCoordIntersectsViewport([R,g,y],x)||(l-R<=h?(++p,C=t.getTile(R,g,y,n,s),C.getState()==m.IDLE&&(f[C.getKey()]=!0,u.isKeyQueued(C.getKey())||u.enqueue([C,c,i.getTileCoordCenter(C.tileCoord),d])),a!==void 0&&a(C)):t.useTile(R,g,y,s));t.updateCacheSize(p,s)}}const ci=hi;class ui extends ei{constructor(e){super(e)}createRenderer(){return new ci(this)}}const Si=ui,pe={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},di=[0,0,0],H=5;class gi{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,Z(Dt(this.resolutions_,function(n,s){return s-n},!0),17);let t;if(!e.origins){for(let n=0,s=this.resolutions_.length-1;n<s;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,Z(this.origins_.length==this.resolutions_.length,20));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=fe(i)),Z(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,Z(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Je,Z(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map(function(n,s){const r=new rt(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const l=this.getTileRangeForExtentAndZ(i,s);r.minX=Math.max(l.minX,r.minX),r.maxX=Math.min(l.maxX,r.maxX),r.minY=Math.max(l.minY,r.minY),r.maxY=Math.min(l.maxY,r.maxY)}return r},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const n=this.getTileRangeForExtentAndZ(e,t);for(let s=n.minX,r=n.maxX;s<=r;++s)for(let l=n.minY,h=n.maxY;l<=h;++l)i([t,s,l])}forEachTileCoordParentTileRange(e,t,i,n){let s,r,l,h=null,a=e[0]-1;for(this.zoomFactor_===2?(r=e[1],l=e[2]):h=this.getTileCoordExtent(e,n);a>=this.minZoom;){if(this.zoomFactor_===2?(r=Math.floor(r/2),l=Math.floor(l/2),s=te(r,r,l,l,i)):s=this.getTileRangeForExtentAndZ(h,a,i),t(a,s))return!0;--a}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,r=e[2]*2;return te(s,s+1,r,r+1,t)}const n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],s=e[1],r=e[2];if(t===n)return te(s,r,s,r,i);if(this.zoomFactor_){const h=Math.pow(this.zoomFactor_,t-n),a=Math.floor(s*h),c=Math.floor(r*h);if(t<n)return te(a,a,c,c,i);const f=Math.floor(h*(s+1))-1,u=Math.floor(h*(r+1))-1;return te(a,f,c,u,i)}const l=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,t,i)}getTileRangeExtent(e,t,i){const n=this.getOrigin(e),s=this.getResolution(e),r=K(this.getTileSize(e),this.tmpSize_),l=n[0]+t.minX*r[0]*s,h=n[0]+(t.maxX+1)*r[0]*s,a=n[1]+t.minY*r[1]*s,c=n[1]+(t.maxY+1)*r[1]*s;return we(l,a,h,c,i)}getTileRangeForExtentAndZ(e,t,i){const n=di;this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,n);const s=n[1],r=n[2];return this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,n),te(s,n[1],r,n[2],i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=K(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),s=K(this.getTileSize(e[0]),this.tmpSize_),r=i[0]+e[1]*s[0]*n,l=i[1]-(e[2]+1)*s[1]*n,h=r+s[0]*n,a=l+s[1]*n;return we(r,l,h,a,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,s){const r=this.getZForResolution(i),l=i/this.getResolution(r),h=this.getOrigin(r),a=K(this.getTileSize(r),this.tmpSize_);let c=l*(e-h[0])/i/a[0],f=l*(h[1]-t)/i/a[1];return n?(c=ae(c,H)-1,f=ae(f,H)-1):(c=he(c,H),f=he(f,H)),qe(r,c,f,s)}getTileCoordForXYAndZ_(e,t,i,n,s){const r=this.getOrigin(i),l=this.getResolution(i),h=K(this.getTileSize(i),this.tmpSize_);let a=(e-r[0])/l/h[0],c=(r[1]-t)/l/h[1];return n?(a=ae(a,H)-1,c=ae(c,H)-1):(a=he(a,H),c=he(c,H)),qe(i,a,c,s)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=Mt(this.resolutions_,e,t||0);return Re(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Yt(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}}const lt=gi;function at(o){let e=o.getDefaultTileGrid();return e||(e=mi(o),o.setDefaultTileGrid(e)),e}function fi(o,e,t){const i=e[0],n=o.getTileCoordCenter(e),s=Se(t);if(ve(s,n))return e;{const r=D(s),l=Math.ceil((s[0]-n[0])/r);return n[0]+=r*l,o.getTileCoordForCoordAndZ(n,i)}}function _i(o,e,t,i){i=i!==void 0?i:"top-left";const n=ht(o,e,t);return new lt({extent:o,origin:Gt(o,i),resolutions:n,tileSize:t})}function Ti(o){const e=o||{},t=e.extent||Xe("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:ht(t,e.maxZoom,e.tileSize,e.maxResolution)};return new lt(i)}function ht(o,e,t,i){e=e!==void 0?e:Zt,t=K(t!==void 0?t:Je);const n=ge(o),s=D(o);i=i>0?i:Math.max(s/t[0],n/t[1]);const r=e+1,l=new Array(r);for(let h=0;h<r;++h)l[h]=i/Math.pow(2,h);return l}function mi(o,e,t,i){const n=Se(o);return _i(n,e,t,i)}function Se(o){o=Xe(o);let e=o.getExtent();if(!e){const t=180*At.degrees/o.getMetersPerUnit();e=we(-t,-t,t,t)}return e}class xi extends bt{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&K(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new nt(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,n){const s=this.getTileCacheForProjection(e);if(!s)return!1;let r=!0,l,h,a;for(let c=i.minX;c<=i.maxX;++c)for(let f=i.minY;f<=i.maxY;++f)h=_e(t,c,f),a=!1,s.containsKey(h)&&(l=s.get(h),a=l.getState()===m.LOADED,a&&(a=n(l)!==!1)),a||(r=!1);return r}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(){return this.tileGrid?this.tileGrid.getResolutions():null}getTile(e,t,i,n,s){return Qe()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:at(e)}getTileCacheForProjection(e){const t=this.getProjection();return Z(t===null||ie(t,e),68),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),s=this.getTilePixelRatio(t),r=K(n.getTileSize(e),this.tmpSize);return s==1?r:Ut(r,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=fi(i,e,t)),Qt(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,n){}}class Ei extends Wt{constructor(e,t){super(e),this.tile=t}}const Ci=xi;function pi(o,e){const t=/\{z\}/g,i=/\{x\}/g,n=/\{y\}/g,s=/\{-y\}/g;return function(r,l,h){if(r)return o.replace(t,r[0].toString()).replace(i,r[1].toString()).replace(n,r[2].toString()).replace(s,function(){const a=r[0],c=e.getFullTileRange(a);return Z(c,55),(c.getHeight()-r[2]-1).toString()})}}function Fi(o,e){const t=o.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=pi(o[n],e);return yi(i)}function yi(o){return o.length===1?o[0]:function(e,t,i){if(e){const n=Ht(e),s=ue(n,o.length);return o[s](e,t,i)}else return}}function Ri(o){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(o);if(t){const i=t[1].charCodeAt(0),n=t[2].charCodeAt(0);let s;for(s=i;s<=n;++s)e.push(o.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(o),t){const i=parseInt(t[2],10);for(let n=parseInt(t[1],10);n<=i;n++)e.push(o.replace(t[0],n.toString()));return e}return e.push(o),e}class Oe extends Ci{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Oe.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=G(t),n=t.getState();let s;n==m.LOADING?(this.tileLoadingKeys_[i]=!0,s=pe.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==m.ERROR?pe.TILELOADERROR:n==m.LOADED?pe.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Ei(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=Ri(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Fi(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const n=_e(e,t,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}const wi=Oe;class Pi extends wi{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Ii,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:tt,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const n in this.tileCacheForProjection){const s=this.tileCacheForProjection[n];s.expireCache(s==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!ie(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!ie(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||ie(t,e)))return this.tileGrid;{const i=G(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=at(e)),this.tileGridForProjection[i]}}getTileCacheForProjection(e){const t=this.getProjection();if(!t||ie(t,e))return this.tileCache;{const i=G(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new nt(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}}createTile_(e,t,i,n,s,r){const l=[e,t,i],h=this.getTileCoordForTileUrlFunction(l,s),a=h?this.tileUrlFunction(h,n,s):void 0,c=new this.tileClass(l,a!==void 0?m.IDLE:m.EMPTY,a!==void 0?a:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=r,c.addEventListener(Ie.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,i,n,s){const r=this.getProjection();if(!r||!s||ie(r,s))return this.getTileInternal(e,t,i,n,r||s);{const l=this.getTileCacheForProjection(s),h=[e,t,i];let a;const c=it(h);l.containsKey(c)&&(a=l.get(c));const f=this.getKey();if(a&&a.key==f)return a;{const u=this.getTileGridForProjection(r),E=this.getTileGridForProjection(s),T=this.getTileCoordForTileUrlFunction(h,s),x=new Pe(r,u,s,E,h,T,this.getTilePixelRatio(n),this.getGutter(),function(p,C,_,d){return this.getTileInternal(p,C,_,d,r)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return x.key=f,a?(x.interimTile=a,x.refreshInterimChain(),l.replace(c,x)):l.set(c,x),x}}}getTileInternal(e,t,i,n,s){let r=null;const l=_e(e,t,i),h=this.getKey();if(!this.tileCache.containsKey(l))r=this.createTile_(e,t,i,n,s,h),this.tileCache.set(l,r);else if(r=this.tileCache.get(l),r.key!=h){const a=r;r=this.createTile_(e,t,i,n,s,h),a.getState()==m.IDLE?r.interimTile=a.interimTile:r.interimTile=a,r.refreshInterimChain(),this.tileCache.replace(l,r)}return r}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=Xe(e);if(i){const n=G(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function Ii(o,e){o.getImage().src=e}const Li=Pi;class vi extends Li{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:Ti({extent:Se(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const Oi=vi;export{Si as T,Oi as X};
//# sourceMappingURL=XYZ-5f96f382.js.map
